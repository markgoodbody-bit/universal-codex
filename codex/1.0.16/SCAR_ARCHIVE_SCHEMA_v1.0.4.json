{
  "version":"1.0.4",
  "type":"object",
  "required":["id","title","domain","severity","hypothesis","tests","mitigations","status","evidence","closure_deadline_days","replicated_by_external"],
  "properties":{
    "id":{"type":"string"},
    "title":{"type":"string"},
    "domain":{"type":"string"},
    "severity":{"type":"string","enum":["low","moderate","high","critical"]},
    "hypothesis":{"type":"string"},
    "tests":{"type":"array","items":{"type":"string"}},
    "mitigations":{"type":"array","items":{"type":"string"}},
    "status":{"type":"string","enum":["open","monitoring","closed","reopened"]},
    "reopened_reason":{"type":"string","description":"Why a previously closed SCAR was reopened"},
    "closure_deadline_days":{"type":"integer","minimum":1},
    "replicated_by_external":{"type":"boolean"},
    "evidence":{
      "type":"array",
      "items":{"anyOf":[
        {"$ref":"#/definitions/InternalEvidence"},
        {"$ref":"#/definitions/ExternalAttestation"}
      ]}
    }
  },
  "definitions":{
    "InternalEvidence":{
      "type":"object",
      "required":["description"],
      "properties":{
        "description":{"type":"string"},
        "filename":{"type":"string"},
        "sha256":{"type":"string"}
      }
    },
    "ExternalAttestation":{
      "type":"object",
      "required":["description","attestor_id","attestor_pubkey_fingerprint","attestation_report_sha256","attestation_timestamp"],
      "properties":{
        "description":{"type":"string"},
        "attestor_id":{"type":"string"},
        "attestor_pubkey_fingerprint":{"type":"string","pattern":"^[0-9A-F]{40}$"},
        "attestation_report_sha256":{"type":"string"},
        "attestation_timestamp":{"type":"string","format":"date-time"}
      }
    }
  },
  "allOf":[
    {"if":{"properties":{"status":{"const":"reopened"}}},"then":{"required":["reopened_reason"]}},
    {"if":{"properties":{"replicated_by_external":{"const":true}}},"then":{
      "properties":{"evidence":{"contains":{"$ref":"#/definitions/ExternalAttestation"}}}
    }}
  ]
}
