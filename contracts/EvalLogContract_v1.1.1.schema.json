{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://universal-codex/contracts/EvalLogContract_v1.1.1.schema.json",
  "title": "EvalLogContract_v1.1.1",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "run_id": {
      "type": "string"
    },
    "timestamp_utc": {
      "type": "string",
      "format": "date-time"
    },
    "operator_id": {
      "type": "string"
    },
    "codex_version": {
      "type": "string"
    },
    "inputs": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "domain": {
          "type": "string",
          "enum": [
            "clinical",
            "justice",
            "moderation",
            "av",
            "other"
          ]
        },
        "context_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },
        "input_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      },
      "required": [
        "domain",
        "context_sha256",
        "input_sha256"
      ]
    },
    "kernel_invariants": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "CONSENT": {
          "type": "boolean"
        },
        "DIGNITY": {
          "type": "boolean"
        },
        "PERSONHOOD": {
          "type": "boolean"
        },
        "NON_INSTRUMENT": {
          "type": "boolean"
        }
      },
      "required": [
        "CONSENT",
        "DIGNITY",
        "PERSONHOOD",
        "NON_INSTRUMENT"
      ]
    },
    "quant": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "cvar_95": {
          "type": "number"
        },
        "maut_score": {
          "type": "number"
        }
      }
    },
    "agree": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "pair_kappa": {
          "type": "number"
        },
        "passed": {
          "type": "boolean"
        }
      }
    },
    "drift": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "psi": {
          "type": "number"
        },
        "page_hinkley_alarm": {
          "type": "boolean"
        },
        "mmd_p": {
          "type": "number"
        },
        "subspace_angle_deg": {
          "type": "number"
        }
      }
    },
    "decision": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "action": {
          "type": "string",
          "enum": [
            "PERMIT",
            "ABSTAIN",
            "BLOCK"
          ]
        },
        "confidence": {
          "type": "number"
        }
      },
      "required": [
        "action",
        "confidence"
      ]
    },
    "publish": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "artifact_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        },
        "scar_link": {
          "type": "string",
          "format": "uri"
        },
        "telemetry_week": {
          "type": "integer"
        }
      },
      "required": [
        "artifact_sha256",
        "scar_link"
      ]
    }
  },
  "required": [
    "run_id",
    "timestamp_utc",
    "operator_id",
    "codex_version",
    "inputs",
    "kernel_invariants",
    "decision",
    "publish"
  ]
}