{
  "$schema":"https://json-schema.org/draft/2020-12/schema",
  "title":"EvalLogContract_v1.1.1",
  "type":"object",
  "required":[ "run_id","timestamp_utc","operator_id","codex_version","inputs","kernel_invariants","decision","publish" ],
  "properties":{
    "run_id":{"type":"string"},
    "timestamp_utc":{"type":"string","format":"date-time"},
    "operator_id":{"type":"string"},
    "codex_version":{"type":"string"},
    "inputs":{
      "type":"object",
      "required":["domain","context_sha256","input_sha256"],
      "properties":{
        "domain":{"enum":["clinical","justice","moderation","av","other"]},
        "context_sha256":{"type":"string","pattern":"^[A-Fa-f0-9]{64}$"},
        "input_sha256":{"type":"string","pattern":"^[A-Fa-f0-9]{64}$"}
      },
      "additionalProperties":false
    },
    "kernel_invariants":{
      "type":"object",
      "required":["CONSENT","DIGNITY","PERSONHOOD","NON_INSTRUMENT"],
      "properties":{
        "CONSENT":{"type":"boolean"},
        "DIGNITY":{"type":"boolean"},
        "PERSONHOOD":{"type":"boolean"},
        "NON_INSTRUMENT":{"type":"boolean"}
      },
      "additionalProperties":false
    },
    "quant":{
      "type":"object",
      "properties":{
        "cvar_95":{"type":"number"},
        "maut_score":{"type":"number"}
      },
      "additionalProperties":false
    },
    "agree":{
      "type":"object",
      "properties":{
        "pair_kappa":{"type":"number"},
        "passed":{"type":"boolean"}
      },
      "additionalProperties":false
    },
    "drift":{
      "type":"object",
      "properties":{
        "psi":{"type":"number"},
        "page_hinkley_alarm":{"type":"boolean"},
        "mmd_p":{"type":"number"},
        "subspace_angle_deg":{"type":"number"}
      },
      "additionalProperties":false
    },
    "decision":{
      "type":"object",
      "required":["action","confidence"],
      "properties":{
        "action":{"enum":["PERMIT","ABSTAIN","BLOCK"]},
        "confidence":{"type":"number"}
      },
      "additionalProperties":false
    },
    "publish":{
      "type":"object",
      "required":["artifact_sha256","scar_link"],
      "properties":{
        "artifact_sha256":{"type":"string","pattern":"^[A-Fa-f0-9]{64}$"},
        "scar_link":{"type":"string","format":"uri"},
        "telemetry_week":{"type":"string"}
      },
      "additionalProperties":false
    }
  },
  "additionalProperties":false
}
